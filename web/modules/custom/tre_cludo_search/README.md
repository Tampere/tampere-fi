TRE  Cludo search
===================

Custom module for embedding and running Cludo search in Drupal as React app.
- Supports node 16 or newer.
- Requires npm.
- Crawlers, fields, engines and analytics are managed in [MyCludo](https://my.cludo.com/) where you
can access with client login credentials.

- Search widget basic configuration managed in `src/index.ts`.

# Developing search widgets in React app

- To enable search in your local. Set Cludo engine id and customer id in
- Drupal's `web/sites/default/settings.local.php` file as following:<br>
  `$settings ['cludo_customer_id'] = <customeridhere>;` <br>
  `$settings ['cludo_engine_id'] = <engineidhere>;` <br>
  You can find in these id's from clients [MyCludo](https://my.cludo.com/) service.
- Create personal token (classic) in your Github account. This will be needed
only while installing required npm packages in your local. Make sure the token
has  `read:packages`  access. Read more about tokens in
[GiHub](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens)

- Navigate to this modules `App/` directory in terminal.
- Login and set the Cludo package scope with <br>
  `npm login --scope=@cludo --registry=https://npm.pkg.github.com` <br>
  Enter your Github credentials when prompted. Use the personal access token
you created as your password.
- Install packages with `npm install`
- Build project with `cludo-cli build` or `npm run build`
- Run `cludo-cli dev` to start local server, where you can test current search
configuration on your host machine outside Drupal.
It also watches and builds changes automatically.

# Setup in Drupal side

In Drupal side, app requires to have html elements as the following: <br>
- A container around a existing search input element. The container should have
an ID that matches one of the IDs entered in the `searchInputSelectors` config
property. In this project we use `#cludo-search-input` selector.
- A container for search results that matches the css selector entered
in the `searchResultsWrapperSelector` config property.
In this project we use `.cludo-search-results` selector.
- -A container for search controls that matches the css selector entered in
the `controlsWrapperSelector` config property.
In this project we use `.cludo-search-controls` selector.

Selectors presented above can be modified in `index.ts`.
These elements are set `page--cludo-search.html.twig` template.<br>
<br>
<b>Important:
Make sure that ``customer.cludo.com/scripts/bundles/search-script.min.js``
external library is included in module. Otherwise
search won't work at all.</b> <br>
Required libraries are defined in `tre_cludo_search.libraries.yml`.

# Configuring Cludo search
- Basic search widget configuration is
in ``tre_cludo_search/App/src/index.ts`` file.
See full documentation of this configration file in
https://react.cludo.com/?path=/docs/overview-creating-a-project-configuration-options--docs
- See full documentation of Cludo search React library
in https://react.cludo.com/?path=/docs/overview-getting-started--docs
- Search settings, indexing, analytics, crawling, fields etc. are managed
directly in [MyCludo](https://my.cludo.com/)  account with client credentials.
- You can  either modify default components generated by `cludo-cli`
or create your own custom components like in any React App.

# Deployment
- Unlike in themes, we don't build app in servers during deployment.
Instead, we build assets in local and add changed files in ``dist`` to git repo.